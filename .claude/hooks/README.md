# Claude Code Hooks - Dual System

**Purpose:** Automatically track and document all Claude Code sessions

---

## ğŸ¯ Two-Part System

### Part 1: Prompt Logging (Local Files)
**Purpose:** Save all prompts to docs/dev-logs/ for senior management review

**Hook:** `user-prompt-submit-enhanced.sh` â†’ `prompt-logger.js`
**Triggers:** When you submit a prompt
**Output:** `docs/dev-logs/issue-{N}.md` or `session-{date}.md`

**What Gets Logged:**
- Your exact prompt
- Git branch and issue number
- Modified files
- Timestamp

### Part 2: PR Comments (GitHub)
**Purpose:** Auto-comment on PRs with session summaries

**Hook:** `post-tool-use.sh` â†’ `pr-commenter.js`
**Triggers:** After Write/Edit/Bash tools (when 2+ tools used)
**Output:** Comment on current PR

**What Gets Posted:**
- Prompt asked
- Files created/edited
- Commands run
- Duration and summary

---

## ğŸ“‹ How It Works

### Workflow Example

```bash
# 1. Create feature branch & PR
git checkout -b feature/3-add-delete
gh pr create --title "Add delete endpoint"

# 2. Ask Claude Code
"Please implement DELETE /api/tasks/:id endpoint"
# â†’ Prompt logged to docs/dev-logs/issue-3.md

# 3. Claude uses Write tool
# â†’ Session tracking starts

# 4. Claude uses Edit tool
# â†’ Threshold reached (2 tools)

# 5. Automatic PR comment posted!
# â†’ Summary appears on PR #3
```

### PR Comment Format

```markdown
## ğŸ¤– Claude Code Session Summary

**Time:** 2025-11-21 12:30:00 (2m)

### ğŸ“ Prompt Asked
```
Please implement DELETE /api/tasks/:id endpoint
```

### âœ… What Was Done

**Files Created (0):**

**Files Edited (2):**
- `src/routes/tasks.js`
- `src/controllers/taskController.js`

**Commands Run (1):**
- Run tests with Jest

### ğŸ“Š Summary

- **Total files modified:** 2
- **Tools used:** 3
- **Duration:** 2m

---
*Auto-generated by Claude Code PR Commenter*
```

---

## âš™ï¸ Configuration

### Current Settings (`.claude/settings.json`)

```json
{
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/user-prompt-submit-enhanced.sh"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": {
          "tool_name": "(Write|Edit|Bash)"
        },
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/post-tool-use.sh"
          }
        ]
      }
    ]
  }
}
```

### Customization

**Change tools that trigger PR comments:**
Edit `.claude/hooks/pr-commenter.js`:
```javascript
const CONFIG = {
  significantTools: ['Write', 'Edit', 'Bash', 'NotebookEdit'],  // Add more
  minToolsThreshold: 2,  // Change to 1 for more frequent comments
};
```

**Change prompt filtering:**
Edit `.claude/hooks/prompt-logger.js`:
```javascript
const CONFIG = {
  minPromptLength: 50,  // Minimum prompt length
  technicalKeywords: [...],  // Add your keywords
};
```

---

## ğŸ“ Files

```
.claude/
â”œâ”€â”€ settings.json                          â† Hook configuration
â””â”€â”€ hooks/
    â”œâ”€â”€ user-prompt-submit.sh              â† Original (not used)
    â”œâ”€â”€ user-prompt-submit-enhanced.sh     â† Enhanced (calls both loggers)
    â”œâ”€â”€ prompt-logger.js                   â† Logs to docs/dev-logs/
    â”œâ”€â”€ post-tool-use.sh                   â† PR comment wrapper
    â”œâ”€â”€ pr-commenter.js                    â† Posts PR comments
    â”œâ”€â”€ test-hook.sh                       â† Test script
    â””â”€â”€ README.md                          â† This file
```

---

## ğŸ§ª Testing

### Test Prompt Logging

```bash
./.claude/hooks/test-hook.sh

# Check results
cat docs/dev-logs/*.md
```

### Test PR Comments (Requires open PR)

```bash
# On a PR branch
git checkout feature/3-add-delete

# Simulate session
echo '{"hook_event_name":"UserPromptSubmit","prompt":"Test prompt for PR commenting"}' | ./.claude/hooks/user-prompt-submit-enhanced.sh

echo '{"hook_event_name":"PostToolUse","tool_name":"Write","file_path":"test.js"}' | ./.claude/hooks/post-tool-use.sh

echo '{"hook_event_name":"PostToolUse","tool_name":"Edit","file_path":"test2.js"}' | ./.claude/hooks/post-tool-use.sh

# Should post comment to PR
```

---

## ğŸ› Troubleshooting

### PR Comments Not Posting

**Check 1: Are you on a PR branch?**
```bash
gh pr list --head $(git branch --show-current)
# Should show your PR
```

**Check 2: GitHub CLI authenticated?**
```bash
gh auth status
# Should show: Logged in to github.com
```

**Check 3: Session tracking?**
```bash
cat .claude/session-tracking.json
# Should show current session data
```

### Prompts Not Logging

**Check 1: Hook configured?**
```bash
cat .claude/settings.json
# Should show UserPromptSubmit hook
```

**Check 2: Prompt long enough?**
Minimum 50 characters with technical keywords

**Check 3: Hook executable?**
```bash
ls -la .claude/hooks/*.sh
# All should have -rwxr-xr-x permissions
```

---

## ğŸ’¡ Best Practices

### When to Expect PR Comments

**Will post after:**
- 2+ significant tools used (Write, Edit, Bash)
- On a branch with open PR
- GitHub CLI authenticated

**Won't post if:**
- Still on main branch (no PR)
- Only 1 tool used
- Tools are Read/Grep/Glob (non-modifying)

### Session Boundaries

Each PR comment represents one "session":
- Starts when you submit a prompt
- Tracks all tools used
- Posts comment after threshold
- Clears and starts new session

**Multiple sessions = Multiple comments** (as intended!)

### Combining with Manual Comments

You can also manually comment on PRs:
```bash
gh pr comment 3 --body "Manually adding context..."
```

Both automated and manual comments coexist.

---

## ğŸ“ Why Two Systems?

### Local Logging (docs/dev-logs/)
- **For:** Senior management, auditing, offline access
- **Content:** All prompts (even exploratory)
- **Format:** Markdown files, organized by issue
- **Retention:** Committed to git, permanent

### PR Comments (GitHub)
- **For:** Team collaboration, PR reviewers
- **Content:** What was actually done (files + commands)
- **Format:** GitHub comments with summaries
- **Retention:** Lives with PR, part of review process

**Both serve different purposes - not duplication!**

---

## ğŸ”— Related Documentation

- **Workflow System:** `/home/pankaj/workflow-system/`
- **HOOKS-SETUP.md:** Complete hook setup guide
- **PROMPT-COMPATIBILITY.md:** How @claude prompts work

---

**Status:** âœ… Production Ready
**Requirements Met:**
- âœ… Save all prompts locally (senior requirement)
- âœ… Auto-comment PRs with session summaries
- âœ… Track what was done, files modified, duration
- âœ… Non-blocking, fault-tolerant

---

*This dual-hook system ensures complete traceability of all Claude Code sessions, both for management review and team collaboration.*
